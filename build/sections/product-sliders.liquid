{% comment %} Product Sliders in tabs {% endcomment %}
{% assign limitProductsReturned = 12 %}

{%- capture sliderConfig -%}
	{
		"dots" : false,
		"arrows" : false,
		"autoplay" : false,
		"autoplaySpeed" : false,
		"slidesToShow": 4,
		"slidesToScroll" : 1,
		"lazyLoad": "ondemand",
		"responsive": [
          {
            "breakpoint": 1024,
            "settings": {
              "slidesToShow": 5
            }
          },
          {
            "breakpoint": 920,
            "settings": {
              "slidesToShow": 4
            }
          },
          {
            "breakpoint": 768,
            "settings": {
              "slidesToShow": 4
            }
          },
          {
            "breakpoint": 767,
            "settings": {
              "slidesToShow": 3
            }
          },
          {
            "breakpoint": 640,
            "settings": {
              "slidesToShow": 2
            }
          }
        ]
	}
{%- endcapture -%}


<div class="product-slider" id="product-slider-wrapper-{{section.id}}">
	<ul id="slider-nav-{{section.id}}">
		{% for block in section.blocks %}
			<li
				id="list-click-{{block.id}}"
				data-load-slider="load-{{block.id}}"
				data-section-id="{{section.id}}"
			>
				{% assign collectionData = collections[block.settings.collectionHandle] %}
				
				{% capture productIds %}
					[{%- for product in collectionData.products -%}"{{product.handle}}"{% if forloop.last == false %}{% if forloop.index != limitProductsReturned %},{% endif %}{% endif %}{%- endfor -%}]
				{% endcapture %}

				{% capture tabData %}{ "count": {{collectionData.all_products_count}},"productIds": {{productIds | strip }} }{% endcapture %}
				<span 
					data-accordion-tabs-action="trigger-best-sellers"
					data-accordion-tabs-products-{{section.id}}="{{tabData | strip}}"
				>
					{{block.settings.title}}
				</span>
				<div class="hidden-data-set" style="display: none;">
					{%- for product in collectionData.products -%}
						{% if forloop.index <= limitProductsReturned %}
							<div 
								class="slider-product"
								id="slideshow-block-{{slide.id}}"
								data-slick-theme-editor-index="{{forloop.index0}}"
								{{ slide.shopify_attributes }}
							>
								<img data-lazy="{{product.featured_image | img_url: '300x' }}" alt="{{product.title}}" />
								<h3>{{product.title}}</h3>
								<span class="price">
									{% if product.price_varies %}
										{{ product.price_min | money_without_trailing_zeros }} - {{product.price_max |  money_without_trailing_zeros | money_without_currency  }}
									{% endif %}
								</span>
							</div>
						{% endif %}
					{%- endfor -%}
				</div>
			</li>
		{% endfor %}
	</ul>

	<div 
		data-dynamic-slider-area="{{section.id}}"
		id="slideshow-{{section.id}}"
		data-slick-slideshow="{{section.id}}"
		data-slick-config='{{sliderConfig}}'
	>
	
	</div>
</div>

<script>
	const sliderNavigationItems = document.querySelectorAll('li[data-load-slider]')
	sliderNavigationItems.forEach(
		function(node) {
			console.log(node)
			document.getElementById(node.id).addEventListener('click', function() {
				const sliderItems = document.querySelector(`#${node.id} .hidden-data-set`).innerHTML
				const sliderWrapper = `slideshow-${node.dataset.sectionId}`
				document.getElementById(sliderWrapper).innerHTML = sliderItems
				window.initSlider(sliderWrapper)
			})
	})
</script>

{% schema %}
	{
		"name": "Product Sliders",
		"settings" : [],
		"blocks" : [
			{
				"type": "slider",
				"name": "Slider",
				"settings" : [
					{
						"type":      "text",
						"id":        "title",
						"label":     "Slider Navigation Label",
						"default":   "Best Sellers"
					},
					{
						"type":      "collection",
						"id":        "collectionHandle",
						"label":     "Select a collection"
					}
				]
			}
		],
		"presets": [
      {
        "name": "Product Sliders",
        "category": "Visual Marketing"
      }
    ]
	}
{% endschema %}